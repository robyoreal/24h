<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>24 Hours Wall</title>
  <link rel="stylesheet" href="/src/styles/main.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jim+Nightshade&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jim+Nightshade&family=Margarine&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Limelight&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DynaPuff:wght@400..700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Bottom-Left Toolbar -->
  <div id="bottom-toolbar">

    <!-- Undo Button (conditionally visible) - MOVED TO TOP -->
    <div id="undo-btn-wrap" class="hidden">
      <button id="undo-btn" class="circle-btn" title="Undo">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 7v6h6M3 13a9 9 0 1 0 2-5.5"/>
        </svg>
      </button>
    </div>

    <!-- Lock Button (unlock / lock brush / lock movement selector) -->
    <div id="lock-btn-wrap">
      <button id="lock-btn" class="circle-btn">
        <!-- Icon swaps based on active lock mode. Default: unlock -->
        <svg id="lock-icon-unlock" class="lock-icon active" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="11" width="14" height="10" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
        </svg>
        <svg id="lock-icon-brush" class="lock-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="11" width="14" height="10" rx="2" ry="2"/>
          <path d="M12 16v-1"/>
          <circle cx="12" cy="14" r="0.5" fill="currentColor"/>
        </svg>
        <svg id="lock-icon-movement" class="lock-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="11" width="14" height="10" rx="2" ry="2"/>
          <path d="M12 16h-1m2 0h1"/>
        </svg>
      </button>
      <!-- Arc menu (hidden by default, shown on lock-btn click) -->
      <div id="lock-arc" class="arc-menu hidden">
        <button class="arc-btn" data-lock="unlock" title="Unlock - Normal mode">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="5" y="11" width="14" height="10" rx="2" ry="2"/>
            <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
          </svg>
        </button>
        <button class="arc-btn" data-lock="brush" title="Lock Brush - Multi-touch drawing">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="5" y="11" width="14" height="10" rx="2" ry="2"/>
            <path d="M12 16v-1"/>
            <circle cx="12" cy="14" r="0.5" fill="currentColor"/>
          </svg>
        </button>
        <button class="arc-btn" data-lock="movement" title="Lock Movement - Pan only">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="5" y="11" width="14" height="10" rx="2" ry="2"/>
            <path d="M12 16h-1m2 0h1"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Tool Button (brush / text / eraser selector) -->
    <div id="tool-btn-wrap">
      <button id="tool-btn" class="circle-btn">
        <!-- Icon swaps based on active tool. Default: brush -->
        <svg id="tool-icon-brush" class="tool-icon active" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2l9 9-9 9-9-9 9-9z"/>
        </svg>
        <svg id="tool-icon-text" class="tool-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <text x="5" y="18" font-size="16" font-weight="bold" fill="currentColor" stroke="none">T</text>
        </svg>
        <svg id="tool-icon-eraser" class="tool-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="10" width="18" height="8" rx="2" ry="2"/>
          <line x1="9" y1="10" x2="6" y2="18"/>
        </svg>
      </button>
      <!-- Arc menu (hidden by default, shown on tool-btn click) -->
      <div id="tool-arc" class="arc-menu hidden">
        <button class="arc-btn" data-tool="brush">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l9 9-9 9-9-9 9-9z"/></svg>
        </button>
        <button class="arc-btn" data-tool="text">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><text x="5" y="18" font-size="16" font-weight="bold" fill="currentColor" stroke="none">T</text></svg>
        </button>
        <button class="arc-btn" data-tool="eraser">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="10" width="18" height="8" rx="2" ry="2"/><line x1="9" y1="10" x2="6" y2="18"/></svg>
        </button>
      </div>
    </div>

    <!-- Width Dial -->
    <div id="width-dial-wrap">
      <div id="width-dial" class="circle-btn" title="Drag to adjust width">
        <span id="width-dial-label">10</span>
      </div>
    </div>

    <!-- Color Button -->
    <div id="color-btn-wrap">
      <button id="color-btn" class="circle-btn">
        <div id="color-btn-swatch"></div><!-- background color set via JS -->
      </button>
      <!-- Color arc menu (generated dynamically from COLOR_PALETTE) -->
      <div id="color-arc" class="arc-menu hidden">
      </div>
    </div>

    <!-- Font Button (visible only in text mode) -->
    <div id="font-btn-wrap" class="hidden">
      <button id="font-btn" class="circle-btn">
        <span id="font-btn-label">Sans</span>
      </button>
      <!-- Font arc menu (generated dynamically from FONT_OPTIONS) -->
      <div id="font-arc" class="arc-menu hidden">
      </div>
    </div>

    <!-- Ink Gauge (circular) -->
    <div id="ink-gauge-wrap">
      <div id="ink-gauge" class="circle-btn" title="Ink remaining">
        <svg id="ink-gauge-svg" width="44" height="44" viewBox="0 0 44 44">
          <circle class="ink-gauge-bg" cx="22" cy="22" r="18" />
          <circle id="ink-gauge-arc" class="ink-gauge-fill" cx="22" cy="22" r="18" />
        </svg>
        <span id="ink-gauge-label">100%</span>
      </div>
    </div>

  </div>

  <!-- Canvas Container -->
  <div id="canvas-container">
    <canvas id="main-canvas"></canvas>
  </div>

  <!-- Text input is now inline on canvas (no modal needed) -->

  <!-- Firebase Config Notice -->
  <div id="firebase-notice" class="notice">
    âš ï¸ Firebase not configured. See <code>src/config/firebase.config.js</code>
  </div>

  <!-- Admin Panel (hidden by default) -->
  <div id="admin-panel" class="admin-panel hidden">
    <div class="admin-content">

      <!-- Header -->
      <div class="admin-header">
        <h2>âš™ï¸ Admin Panel</h2>
        <button id="admin-close" class="admin-close-btn">âœ•</button>
      </div>

      <!-- Tabs -->
      <div class="admin-tabs">
        <button class="admin-tab active" data-tab="stats">Stats</button>
        <button class="admin-tab" data-tab="config">Config</button>
        <button class="admin-tab" data-tab="users">Users</button>
        <button class="admin-tab" data-tab="data">Data</button>
      </div>

      <!-- Tab: Stats -->
      <div id="admin-tab-stats" class="admin-tab-content active">
        <h3>System Stats</h3>
        <div class="admin-stat-grid">
          <div class="admin-stat-card">
            <div class="admin-stat-label">Total Users</div>
            <div class="admin-stat-value" id="stat-total-users">â€”</div>
          </div>
          <div class="admin-stat-card">
            <div class="admin-stat-label">Active Tiles</div>
            <div class="admin-stat-value" id="stat-active-tiles">â€”</div>
          </div>
          <div class="admin-stat-card">
            <div class="admin-stat-label">Total Strokes</div>
            <div class="admin-stat-value" id="stat-total-strokes">â€”</div>
          </div>
        </div>
        <button id="admin-refresh-stats" class="admin-btn">ğŸ”„ Refresh Stats</button>
      </div>

      <!-- Tab: Config -->
      <div id="admin-tab-config" class="admin-tab-content">
        <h3>App Configuration</h3>
        <div class="admin-form">
          <label>
            Max Ink Per User
            <input type="number" id="config-max-ink" value="250000" step="1000">
          </label>
          <label>
            Ink Refill Rate (per hour)
            <input type="number" id="config-refill-rate" value="10000" step="100">
          </label>
          <label>
            Fade Duration (hours)
            <input type="number" id="config-fade-duration" value="24" step="1">
          </label>
          <label>
            Inactivity Timeout (seconds)
            <input type="number" id="config-inactivity" value="10" step="1">
          </label>
          <label>
            <input type="checkbox" id="config-maintenance-mode">
            Maintenance Mode (disable drawing)
          </label>
          <label>
            <input type="checkbox" id="config-unlimited-ink">
            Unlimited Ink Mode (disable ink limits)
          </label>
          <label>
            <input type="checkbox" id="config-allow-text" checked>
            Allow Text Tool
          </label>
          <label>
            <input type="checkbox" id="config-allow-eraser" checked>
            Allow Eraser Tool
          </label>
        </div>

        <!-- Color Palette Manager -->
        <div class="admin-section">
          <h4>ğŸ¨ Color Palette</h4>
          <div id="admin-color-palette" class="admin-color-palette">
            <!-- Color items generated dynamically -->
          </div>
          <div class="admin-color-controls">
            <button id="admin-add-color" class="admin-btn">â• Add Color</button>
            <button id="admin-reset-colors" class="admin-btn">ğŸ”„ Reset to Default</button>
          </div>
          <p class="admin-note">ğŸ’¡ Click color to edit â€¢ Click âœ• to remove â€¢ First color = default â€¢ Last color should be light (white recommended)</p>
        </div>

        <!-- Font Manager -->
        <div class="admin-section">
          <h4>ğŸ”¤ Available Fonts</h4>
          <div id="admin-font-list" class="admin-font-list">
            <!-- Font items generated dynamically -->
          </div>
          <div class="admin-font-controls">
            <button id="admin-add-font" class="admin-btn">â• Add Font</button>
            <button id="admin-reset-fonts" class="admin-btn">ğŸ”„ Reset to Default</button>
          </div>
          <p class="admin-note">ğŸ’¡ Click font to edit â€¢ Click âœ• to remove â€¢ First font = default for text tool</p>
        </div>

        <!-- Button Icons Manager -->
        <div class="admin-section">
          <h4>ğŸ–¼ï¸ Button Icons</h4>
          <p class="admin-note">ğŸ’¡ Enter an image URL to replace a button icon. Leave blank to use the default SVG.</p>
          <div class="admin-form">
            <label>
              Brush Icon URL
              <input type="text" id="config-icon-tool-brush" placeholder="https://...">
            </label>
            <label>
              Text Icon URL
              <input type="text" id="config-icon-tool-text" placeholder="https://...">
            </label>
            <label>
              Eraser Icon URL
              <input type="text" id="config-icon-tool-eraser" placeholder="https://...">
            </label>
            <label>
              Unlock Icon URL
              <input type="text" id="config-icon-lock-unlock" placeholder="https://...">
            </label>
            <label>
              Brush Lock Icon URL
              <input type="text" id="config-icon-lock-brush" placeholder="https://...">
            </label>
            <label>
              Movement Lock Icon URL
              <input type="text" id="config-icon-lock-movement" placeholder="https://...">
            </label>
          </div>
        </div>

        <!-- Splash Screen Content -->
        <div class="admin-section">
          <h4>ğŸ’¬ Splash Screen</h4>
          <p class="admin-note">Content shown to first-time visitors. Leave blank to use default text.</p>
          <div class="admin-form">
            <label>
              Title (Bahasa Indonesia)
              <input type="text" id="config-splash-title-id" placeholder="Tembok 24 Jam">
            </label>
            <label>
              Description (Bahasa Indonesia)
              <textarea id="config-splash-desc-id" rows="3" placeholder="Default description..."></textarea>
            </label>
            <label>
              Title (English)
              <input type="text" id="config-splash-title-en" placeholder="24 Hours Wall">
            </label>
            <label>
              Description (English)
              <textarea id="config-splash-desc-en" rows="3" placeholder="Default description..."></textarea>
            </label>
          </div>
        </div>

        <button id="admin-save-config" class="admin-btn admin-btn-primary">ğŸ’¾ Save All Changes</button>
        <p class="admin-note">âš ï¸ Changes apply immediately. Users must refresh to see updates.</p>
      </div>

      <!-- Tab: Users -->
      <div id="admin-tab-users" class="admin-tab-content">
        <h3>User Management</h3>
        <div class="admin-search">
          <input type="text" id="admin-user-search" placeholder="Search by IP hash or country...">
          <button id="admin-search-users" class="admin-btn">ğŸ” Search</button>
        </div>
        <div id="admin-user-list" class="admin-user-list">
          <p class="admin-placeholder">Enter IP hash or country code to search</p>
        </div>
      </div>

      <!-- Tab: Data -->
      <div id="admin-tab-data" class="admin-tab-content">
        <h3>Data Management</h3>
        <div class="admin-danger-zone">
          <h4>âš ï¸ Danger Zone</h4>
          <button id="admin-cleanup-old-strokes" class="admin-btn admin-btn-warning">
            ğŸ§¹ Cleanup Fully Faded Strokes (24h+)
          </button>
          <button id="admin-reset-all-ink" class="admin-btn admin-btn-danger">
            ğŸ’§ Reset All User Ink to Max
          </button>
          <button id="admin-export-data" class="admin-btn">
            ğŸ“¥ Export All Data (JSON)
          </button>
        </div>
      </div>

    </div>
  </div>

  <!-- Admin Login Modal -->
  <div id="admin-login-modal" class="admin-modal hidden">
    <div class="admin-modal-content">
      <h3>ğŸ” Admin Login</h3>
      <input type="password" id="admin-password" placeholder="Enter admin password" autocomplete="off">
      <div class="admin-modal-buttons">
        <button id="admin-login-submit" class="admin-btn admin-btn-primary">Login</button>
        <button id="admin-login-cancel" class="admin-btn">Cancel</button>
      </div>
      <p id="admin-login-error" class="admin-error hidden">Incorrect password</p>
    </div>
  </div>

  <!-- Color Picker Modal (for editing palette colors) -->
  <div id="admin-color-picker-modal" class="admin-modal hidden">
    <div class="admin-modal-content">
      <h3>Edit Color</h3>
      <input type="color" id="admin-color-picker" value="#000000">
      <input type="text" id="admin-color-hex" placeholder="#000000" maxlength="7">
      <div class="admin-modal-buttons">
        <button id="admin-color-save" class="admin-btn admin-btn-primary">Save</button>
        <button id="admin-color-cancel" class="admin-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Font Editor Modal -->
  <div id="admin-font-editor-modal" class="admin-modal hidden">
    <div class="admin-modal-content">
      <h3>Edit Font</h3>
      <label>
        Font Name (Display)
        <input type="text" id="admin-font-name" placeholder="Arial">
      </label>
      <label>
        CSS Font Family
        <input type="text" id="admin-font-family" placeholder="Arial, sans-serif">
      </label>
      <label>
        Category
        <select id="admin-font-category">
          <option value="sans-serif">Sans Serif</option>
          <option value="serif">Serif</option>
          <option value="monospace">Monospace</option>
          <option value="cursive">Cursive</option>
          <option value="display">Display</option>
        </select>
      </label>
      <div class="admin-font-preview" id="admin-font-preview">
        The quick brown fox jumps over the lazy dog
      </div>
      <div class="admin-modal-buttons">
        <button id="admin-font-save" class="admin-btn admin-btn-primary">Save</button>
        <button id="admin-font-cancel" class="admin-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Admin Access Button (bottom-right corner) -->
  <button id="admin-access-btn" class="admin-access-btn" title="Admin Panel">âš™ï¸</button>

  <!-- First-Time User Splash Screen -->
  <div id="splash-screen" class="hidden">
    <div class="splash-content">
      <button id="splash-lang-toggle" class="splash-lang-btn">English</button>
      <div id="splash-id" class="splash-lang active">
        <h1>Tembok 24 Jam</h1>
        <p id="splash-desc-id">Selamat datang di kanvas bersama tanpa batas! Di sini kamu bisa menggambar dan menulis bersama orang-orang dari seluruh dunia. Semua gambar akan menghilang dalam 24 jam â€” seperti kapur di papan tulis. Gunakan tinta dengan bijak dan biarkan kreativitasmu mengalir!</p>
        <button class="splash-ok-btn splash-ok">Mengerti!</button>
      </div>
      <div id="splash-en" class="splash-lang">
        <h1>24 Hours Wall</h1>
        <p id="splash-desc-en">Welcome to the infinite collaborative canvas! Here you can draw and write together with people from around the world. All drawings disappear after 24 hours â€” like chalk on a blackboard. Use your ink wisely and let your creativity flow!</p>
        <button class="splash-ok-btn splash-ok">Got it!</button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>